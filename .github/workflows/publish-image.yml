
name: Publish Image

on:
  push: # push åˆ°ä¸»åˆ†æ”¯è‡ªåŠ¨ å‘å¸ƒ
    branches: ["main"]
    paths-ignore: # å¿½ç•¥ä¸€äº›ä¸å¿…è¦çš„æ–‡ä»¶
      - ".gitignore"
      - "README.md"
      - ".vscode/**"
  repository_dispatch:
    types: [second_brain_sync]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_TOKEN }}
          submodules: true
      - run: |
          git submodule init
          git submodule update --remote
      - uses: docker/login-action@v1
        with:
          registry: registry.cn-shanghai.aliyuncs.com # å£°æ˜é•œåƒæº
          username: ${{ secrets.ALIYUN_USER }} # å½“å‰github ç”¨æˆ·å
          password: ${{ secrets.ALIYUN_PWD }} # éœ€è¦å» https://github.com/settings/tokens ç”Ÿæˆä¸€ä¸ª åä¸º tokenï¼Œæ³¨æ„æ­¤token éœ€è¦è¯»å†™ packages ç­‰æƒé™
      - uses: actions/setup-node@v2
        with:
          node-version: "20.12.1"
      - name: Install and Build ğŸ”§
        run: |
          npm ci
          npm run build

      - name: Show Dir
        run: ls

      - name: Build the  Docker image
        run:
          | # ä½¿ç”¨ ä¸Šä¸€æ­¥å†™çš„ Dockerfile æ„å»ºé•œåƒå¹¶å‘å¸ƒåˆ°ç§æœ‰ä»“åº“ï¼› å‘å¸ƒå®Œæˆå¯ä»¥å» https://github.com/songxingguo?tab=packages æŸ¥çœ‹
          docker build . --file Dockerfile --tag registry.cn-shanghai.aliyuncs.com/songxingguo/blog:latest
          docker push registry.cn-shanghai.aliyuncs.com/songxingguo/blog:latest
  